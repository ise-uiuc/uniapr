# Defects4J Maven Projects (V1.2.0) for UniAPR

The purpose of this directory is to automatically convert Defects4J projects into maven projects, allowing them to be run with UniAPR. Some Defects4J projects may not be maven projects, making it impossible to use UniAPR directly with them. Furthermore, the results produced by UniAPR's profiler may differ from those generated by the `defects4j test` command. This directory ensures that Defects4J projects are properly configured as maven projects and that UniAPR's profiler produces the same test results as Defects4J. Currently, only Defects4J V1.2.0 projects are supported, and support for Defects4J V2.0.0 projects is still underway.

## Requirements

1. Java 1.8
2. Defects4J 2.0.0

## Usage

```shell
python3 setupProj.py -s
```

The script will
1. Use defects4j to checkout all projects
2. Copy the prepared pom.xml to the project directories
3. Apply patches to the projects' source code if necessary
4. Use defects4j to compile the project (Closure-106 needs maven to compile)
5. If the `-s` option (skipping testing) is not specified, run `defects4j test` to generate file `all_tests` and `failing_tests` (`all_tests` will be used by Uniapr to run the same set of tests). And then check whether `defects4j test` fails the expected tests using the information in `failing_tests` and `defects4j info`.
7. If the `-s` option is specified, directly copy the prepared `all_tests` files to the root path of the project.

## Note

- Please note that Unipar can not validate the patches for Mockito-5 now (it requires that the validating JVM does not load the class junit.framework.ComparisonFailure).
- If you want to validate project Closure-106 by yourself, please make sure to
    - run `mvn clean && defects4j compile` to compile first, if you want to run `defects4j test`.
    - run `mvn test-compile` to compile first, if you want to run Uniapr.